{"ast":null,"code":"import React, { useMemo } from 'react';\n\nfunction isFunction(x) {\n  return !!x && {}.toString.call(x) === '[object Function]';\n}\n\nfunction isInBrowser() {\n  return typeof window === 'object' && typeof document === 'object';\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nvar createMemoryStorage = function createMemoryStorage() {\n  return new MemoryStorage();\n};\n\nvar MemoryStorage = /*#__PURE__*/function () {\n  function MemoryStorage() {\n    this.memory = {};\n  }\n\n  var _proto = MemoryStorage.prototype;\n\n  _proto.getItem = function getItem(key) {\n    return this.memory[key] || null;\n  };\n\n  _proto.setItem = function setItem(key, value) {\n    this.memory[key] = value;\n  };\n\n  _proto.removeItem = function removeItem(key) {\n    delete this.memory[key];\n  };\n\n  _proto.key = function key(index) {\n    var keys = Object.keys(this.memory);\n    return keys[index] || null;\n  };\n\n  _proto.clear = function clear() {\n    this.memory = {};\n  };\n\n  _createClass(MemoryStorage, [{\n    key: \"length\",\n    get: function get() {\n      return Object.keys(this.memory).length;\n    }\n  }]);\n\n  return MemoryStorage;\n}();\n\nvar defaultStorage;\n\nif (isInBrowser()) {\n  defaultStorage = window.localStorage;\n} else {\n  defaultStorage = /*#__PURE__*/createMemoryStorage();\n}\n\nfunction getDefaultStorage() {\n  return defaultStorage;\n}\n\nfunction setDefaultStorage(storage) {\n  defaultStorage = storage;\n}\n\nfunction useIsMounted() {\n  var ref = React.useRef(true);\n  React.useEffect(function () {\n    return function () {\n      ref.current = false;\n    };\n  }, []);\n  return React.useCallback(function () {\n    return ref.current;\n  }, []);\n}\n\nfunction useStorage(key, defaultValue, getStorage) {\n  if (defaultValue === void 0) {\n    defaultValue = null;\n  }\n\n  if (getStorage === void 0) {\n    getStorage = getDefaultStorage();\n  }\n\n  var isMounted = useIsMounted();\n  var storage = useMemo(function () {\n    if (!isInBrowser()) return createMemoryStorage();\n    if (isFunction(getStorage)) return getStorage();\n    return getStorage;\n  }, [getStorage]);\n  var initialValue = useMemo(function () {\n    var storedString = storage.getItem(key);\n    return storedString === null ? defaultValue : JSON.parse(storedString);\n  }, [storage, key, defaultValue]);\n\n  var _React$useState = React.useState(initialValue),\n      value = _React$useState[0],\n      setValue = _React$useState[1];\n\n  React.useEffect(function () {\n    storage.setItem(key, JSON.stringify(initialValue));\n  }, [key, initialValue]);\n  var setItem = React.useCallback(function (newValue) {\n    if (isFunction(newValue)) {\n      newValue = newValue(value);\n    }\n\n    if (newValue === null) {\n      storage.removeItem(key);\n    } else {\n      storage.setItem(key, JSON.stringify(newValue));\n    }\n\n    if (isMounted()) {\n      setValue(newValue);\n    }\n  }, [storage, key, value]);\n  return [value, setItem];\n}\n\nfunction useRefresh() {\n  var _React$useState = React.useState(0),\n      setVersion = _React$useState[1];\n\n  var isMounted = useIsMounted();\n  return function () {\n    if (isMounted()) {\n      setVersion(function (x) {\n        return x + 1;\n      });\n    }\n  };\n}\n\nvar proxySymbol = /*#__PURE__*/Symbol();\n\nfunction makeProxy(target, notify) {\n  if (target[proxySymbol] === true) {\n    return target;\n  }\n\n  return new Proxy(target, {\n    get: makeTrap('get', notify),\n    defineProperty: makeTrap('defineProperty', notify),\n    deleteProperty: makeTrap('deleteProperty', notify)\n  });\n}\n\nfunction makeTrap(trap, notify) {\n  return function () {\n    if (trap === 'get' && (arguments.length <= 1 ? undefined : arguments[1]) === proxySymbol) {\n      return true;\n    }\n\n    var original = Reflect[trap];\n    var result = original.apply(void 0, arguments);\n\n    if (trap === 'get' && typeof result === 'object' && result !== null) {\n      result = makeProxy(result, notify);\n    }\n\n    if (trap !== 'get') {\n      notify();\n    }\n\n    return result;\n  };\n}\n\nfunction useInstance(Class) {\n  for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    args[_key - 1] = arguments[_key];\n  }\n\n  var refresh = useRefresh();\n  var instance = React.useMemo(function () {\n    return makeProxy(_construct(Class, args), refresh);\n  }, args);\n  React.useEffect(function () {\n    var currentInstance = instance;\n    return function () {\n      return currentInstance.cleanup && currentInstance.cleanup();\n    };\n  }, args);\n  return instance;\n}\n\nfunction usePrevious(value, count) {\n  if (count === void 0) {\n    count = 1;\n  }\n\n  var _React$useState = React.useState([]),\n      history = _React$useState[0],\n      setHistory = _React$useState[1];\n\n  React.useEffect(function () {\n    if (history.length > count) {\n      history.pop();\n    }\n\n    setHistory([value].concat(history));\n  }, [value]);\n  return history.slice(1);\n}\n\nexport { createMemoryStorage, getDefaultStorage, setDefaultStorage, useInstance, useIsMounted, usePrevious, useRefresh, useStorage };","map":{"version":3,"sources":["../src/utils/isFunction.ts","../src/utils/isInBrowser.ts","../src/useStorage/createMemoryStorage.ts","../src/useStorage/defaultStorage.ts","../src/useIsMounted/useIsMounted.ts","../src/useStorage/useStorage.ts","../src/useRefresh/useRefresh.ts","../src/useInstance/makeProxy.ts","../src/useInstance/useInstance.ts","../src/usePrevious/usePrevious.ts"],"names":["isFunction","x","isInBrowser","createMemoryStorage","MemoryStorage","Object","getItem","setItem","removeItem","key","keys","clear","defaultStorage","window","getDefaultStorage","setDefaultStorage","storage","useIsMounted","ref","React","useStorage","defaultValue","getStorage","isMounted","useMemo","initialValue","storedString","JSON","value","setValue","newValue","useRefresh","setVersion","proxySymbol","Symbol","makeProxy","target","notify","get","makeTrap","defineProperty","deleteProperty","trap","original","Reflect","result","useInstance","Class","args","refresh","instance","currentInstance","usePrevious","count","history","setHistory"],"mappings":"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","sourcesContent":["export function isFunction<T>(x: T): T extends Function ? true : false\nexport function isFunction(x: any) {\n  return !!x && {}.toString.call(x) === '[object Function]'\n}\n","export function isInBrowser() {\n  return typeof window === 'object' && typeof document === 'object'\n}\n","export const createMemoryStorage = (): Storage => {\n  return new MemoryStorage()\n}\n\nclass MemoryStorage implements Storage {\n  protected memory: {[key: string]: string} = {}\n\n  public get length() {\n    return Object.keys(this.memory).length\n  }\n\n  public getItem(key: string) {\n    return this.memory[key] || null\n  }\n\n  public setItem(key: string, value: string) {\n    this.memory[key] = value\n  }\n\n  public removeItem(key: string) {\n    delete this.memory[key]\n  }\n\n  public key(index: number) {\n    const keys = Object.keys(this.memory)\n    return keys[index] || null\n  }\n\n  public clear() {\n    this.memory = {}\n  }\n}\n","import {isInBrowser} from '../utils'\nimport {createMemoryStorage} from './createMemoryStorage'\n\ntype LazyStorage = Storage | (() => Storage)\n\nlet defaultStorage: LazyStorage\nif (isInBrowser()) {\n  defaultStorage = window.localStorage\n} else {\n  defaultStorage = createMemoryStorage()\n}\n\nexport function getDefaultStorage() {\n  return defaultStorage\n}\nexport function setDefaultStorage(storage: LazyStorage) {\n  defaultStorage = storage\n}\n","import React from 'react'\n\nexport function useIsMounted() {\n  const ref = React.useRef(true)\n  React.useEffect(() => {\n    return () => {\n      ref.current = false\n    }\n  }, [])\n  return React.useCallback(() => ref.current, [])\n}\n","import React, {useMemo} from 'react'\nimport {isFunction, isInBrowser} from '../utils'\nimport {getDefaultStorage} from './defaultStorage'\nimport {createMemoryStorage} from './createMemoryStorage'\nimport {useIsMounted} from '../useIsMounted/useIsMounted'\n\ntype Value<T> = T | null | ((x: T | null) => T | null)\n\nexport function useStorage<T>(key: string, defaultValue: T | null = null, getStorage = getDefaultStorage()) {\n  const isMounted = useIsMounted()\n  const storage = useMemo<Storage>(() => {\n    if (!isInBrowser()) return createMemoryStorage()\n    if (isFunction(getStorage)) return (getStorage as any)()\n    return getStorage\n  }, [getStorage])\n  const initialValue = useMemo(() => {\n    const storedString = storage.getItem(key)\n    return storedString === null ? defaultValue : JSON.parse(storedString)\n  }, [storage, key, defaultValue])\n\n  const [value, setValue] = React.useState<T | null>(initialValue)\n\n  React.useEffect(() => {\n    storage.setItem(key, JSON.stringify(initialValue))\n  }, [key, initialValue])\n\n  const setItem = React.useCallback(\n    (newValue: Value<T>) => {\n      if (isFunction(newValue)) {\n        newValue = (newValue as any)(value)\n      }\n      if (newValue === null) {\n        storage.removeItem(key)\n      } else {\n        storage.setItem(key, JSON.stringify(newValue))\n      }\n      if (isMounted()) {\n        setValue(newValue)\n      }\n    },\n    [storage, key, value]\n  )\n\n  return [value, setItem] as [T | null, typeof setItem]\n}\n","import React from 'react'\nimport {useIsMounted} from '../useIsMounted/useIsMounted'\n\nexport function useRefresh() {\n  const [, setVersion] = React.useState(0)\n  const isMounted = useIsMounted()\n  return () => {\n    if (isMounted()) {\n      setVersion((x) => x + 1)\n    }\n  }\n}\n","const proxySymbol = Symbol()\n\nexport function makeProxy<T extends {}>(target: T, notify: () => void): T {\n  if ((target as any)[proxySymbol] === true) {\n    return target\n  }\n  return new Proxy(target, {\n    get: makeTrap('get', notify),\n    defineProperty: makeTrap('defineProperty', notify),\n    deleteProperty: makeTrap('deleteProperty', notify),\n  })\n}\n\nfunction makeTrap(trap: keyof typeof Reflect, notify: () => void) {\n  return (...args: any[]) => {\n    if (trap === 'get' && args[1] === proxySymbol) {\n      return true\n    }\n    const original = Reflect[trap] as any\n    let result = original(...args)\n    if (trap === 'get' && typeof result === 'object' && result !== null) {\n      result = makeProxy(result, notify)\n    }\n    if (trap !== 'get') {\n      notify()\n    }\n    return result\n  }\n}\n","import React from 'react'\nimport {makeProxy} from './makeProxy'\nimport {useRefresh} from '../useRefresh/useRefresh'\n\ntype ClassType<T, Args extends any[]> = {\n  new (...args: Args): T\n}\n\nexport function useInstance<T, Args extends any[]>(Class: ClassType<T, Args>, ...args: Args) {\n  const refresh = useRefresh()\n  const instance = React.useMemo<T>(() => makeProxy(new Class(...args), refresh), args)\n  React.useEffect(() => {\n    const currentInstance = instance as any\n    return () => currentInstance.cleanup && currentInstance.cleanup()\n  }, args)\n  return instance\n}\n","import React from 'react'\n\nexport function usePrevious<T>(value: T, count = 1) {\n  const [history, setHistory] = React.useState<T[]>([])\n  React.useEffect(() => {\n    if (history.length > count) {\n      history.pop()\n    }\n    setHistory([value, ...history])\n  }, [value])\n  return history.slice(1)\n}\n"]},"metadata":{},"sourceType":"module"}