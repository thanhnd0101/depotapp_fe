{"version":3,"file":"react-tidy.esm.js","sources":["../src/utils/isFunction.ts","../src/utils/isInBrowser.ts","../src/useStorage/createMemoryStorage.ts","../src/useStorage/defaultStorage.ts","../src/useIsMounted/useIsMounted.ts","../src/useStorage/useStorage.ts","../src/useRefresh/useRefresh.ts","../src/useInstance/makeProxy.ts","../src/useInstance/useInstance.ts","../src/usePrevious/usePrevious.ts"],"sourcesContent":["export function isFunction<T>(x: T): T extends Function ? true : false\nexport function isFunction(x: any) {\n  return !!x && {}.toString.call(x) === '[object Function]'\n}\n","export function isInBrowser() {\n  return typeof window === 'object' && typeof document === 'object'\n}\n","export const createMemoryStorage = (): Storage => {\n  return new MemoryStorage()\n}\n\nclass MemoryStorage implements Storage {\n  protected memory: {[key: string]: string} = {}\n\n  public get length() {\n    return Object.keys(this.memory).length\n  }\n\n  public getItem(key: string) {\n    return this.memory[key] || null\n  }\n\n  public setItem(key: string, value: string) {\n    this.memory[key] = value\n  }\n\n  public removeItem(key: string) {\n    delete this.memory[key]\n  }\n\n  public key(index: number) {\n    const keys = Object.keys(this.memory)\n    return keys[index] || null\n  }\n\n  public clear() {\n    this.memory = {}\n  }\n}\n","import {isInBrowser} from '../utils'\nimport {createMemoryStorage} from './createMemoryStorage'\n\ntype LazyStorage = Storage | (() => Storage)\n\nlet defaultStorage: LazyStorage\nif (isInBrowser()) {\n  defaultStorage = window.localStorage\n} else {\n  defaultStorage = createMemoryStorage()\n}\n\nexport function getDefaultStorage() {\n  return defaultStorage\n}\nexport function setDefaultStorage(storage: LazyStorage) {\n  defaultStorage = storage\n}\n","import React from 'react'\n\nexport function useIsMounted() {\n  const ref = React.useRef(true)\n  React.useEffect(() => {\n    return () => {\n      ref.current = false\n    }\n  }, [])\n  return React.useCallback(() => ref.current, [])\n}\n","import React, {useMemo} from 'react'\nimport {isFunction, isInBrowser} from '../utils'\nimport {getDefaultStorage} from './defaultStorage'\nimport {createMemoryStorage} from './createMemoryStorage'\nimport {useIsMounted} from '../useIsMounted/useIsMounted'\n\ntype Value<T> = T | null | ((x: T | null) => T | null)\n\nexport function useStorage<T>(key: string, defaultValue: T | null = null, getStorage = getDefaultStorage()) {\n  const isMounted = useIsMounted()\n  const storage = useMemo<Storage>(() => {\n    if (!isInBrowser()) return createMemoryStorage()\n    if (isFunction(getStorage)) return (getStorage as any)()\n    return getStorage\n  }, [getStorage])\n  const initialValue = useMemo(() => {\n    const storedString = storage.getItem(key)\n    return storedString === null ? defaultValue : JSON.parse(storedString)\n  }, [storage, key, defaultValue])\n\n  const [value, setValue] = React.useState<T | null>(initialValue)\n\n  React.useEffect(() => {\n    storage.setItem(key, JSON.stringify(initialValue))\n  }, [key, initialValue])\n\n  const setItem = React.useCallback(\n    (newValue: Value<T>) => {\n      if (isFunction(newValue)) {\n        newValue = (newValue as any)(value)\n      }\n      if (newValue === null) {\n        storage.removeItem(key)\n      } else {\n        storage.setItem(key, JSON.stringify(newValue))\n      }\n      if (isMounted()) {\n        setValue(newValue)\n      }\n    },\n    [storage, key, value]\n  )\n\n  return [value, setItem] as [T | null, typeof setItem]\n}\n","import React from 'react'\nimport {useIsMounted} from '../useIsMounted/useIsMounted'\n\nexport function useRefresh() {\n  const [, setVersion] = React.useState(0)\n  const isMounted = useIsMounted()\n  return () => {\n    if (isMounted()) {\n      setVersion((x) => x + 1)\n    }\n  }\n}\n","const proxySymbol = Symbol()\n\nexport function makeProxy<T extends {}>(target: T, notify: () => void): T {\n  if ((target as any)[proxySymbol] === true) {\n    return target\n  }\n  return new Proxy(target, {\n    get: makeTrap('get', notify),\n    defineProperty: makeTrap('defineProperty', notify),\n    deleteProperty: makeTrap('deleteProperty', notify),\n  })\n}\n\nfunction makeTrap(trap: keyof typeof Reflect, notify: () => void) {\n  return (...args: any[]) => {\n    if (trap === 'get' && args[1] === proxySymbol) {\n      return true\n    }\n    const original = Reflect[trap] as any\n    let result = original(...args)\n    if (trap === 'get' && typeof result === 'object' && result !== null) {\n      result = makeProxy(result, notify)\n    }\n    if (trap !== 'get') {\n      notify()\n    }\n    return result\n  }\n}\n","import React from 'react'\nimport {makeProxy} from './makeProxy'\nimport {useRefresh} from '../useRefresh/useRefresh'\n\ntype ClassType<T, Args extends any[]> = {\n  new (...args: Args): T\n}\n\nexport function useInstance<T, Args extends any[]>(Class: ClassType<T, Args>, ...args: Args) {\n  const refresh = useRefresh()\n  const instance = React.useMemo<T>(() => makeProxy(new Class(...args), refresh), args)\n  React.useEffect(() => {\n    const currentInstance = instance as any\n    return () => currentInstance.cleanup && currentInstance.cleanup()\n  }, args)\n  return instance\n}\n","import React from 'react'\n\nexport function usePrevious<T>(value: T, count = 1) {\n  const [history, setHistory] = React.useState<T[]>([])\n  React.useEffect(() => {\n    if (history.length > count) {\n      history.pop()\n    }\n    setHistory([value, ...history])\n  }, [value])\n  return history.slice(1)\n}\n"],"names":["isFunction","x","toString","call","isInBrowser","window","document","createMemoryStorage","MemoryStorage","getItem","key","memory","setItem","value","removeItem","index","keys","Object","clear","length","defaultStorage","localStorage","getDefaultStorage","setDefaultStorage","storage","useIsMounted","ref","React","useRef","useEffect","current","useCallback","useStorage","defaultValue","getStorage","isMounted","useMemo","initialValue","storedString","JSON","parse","useState","setValue","stringify","newValue","useRefresh","setVersion","proxySymbol","Symbol","makeProxy","target","notify","Proxy","get","makeTrap","defineProperty","deleteProperty","trap","original","Reflect","result","useInstance","Class","args","refresh","instance","currentInstance","cleanup","usePrevious","count","history","setHistory","pop","slice"],"mappings":"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"}